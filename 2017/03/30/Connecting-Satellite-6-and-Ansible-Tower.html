<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Connecting Satellite 6 and Ansible Tower</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//100things.wzzrd.com/themes/saga/assets/css/style.css?v=1530100205798" rel="stylesheet" type="text/css">
    <link href="//100things.wzzrd.com/themes/saga/assets/css/animate.min.css?v=1530100205798" rel="stylesheet" type="text/css">
    <link href="http://100things.wzzrd.com/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="http://100things.wzzrd.com/2017/03/30/Connecting-Satellite-6-and-Ansible-Tower.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="100 things to do with Red Hat Management Products" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Connecting Satellite 6 and Ansible Tower" />
    <meta property="og:description" content="Today I want to talk about connecting Satellite 6 and Ansible Tower. There are two main benefits you can get right now from connecting Satellite 6 and Ansible Tower if you use both. Sharing inventory data First of all, if you share inventory data, you share hostnames and IP addresses" />
    <meta property="og:url" content="http://100things.wzzrd.com/2017/03/30/Connecting-Satellite-6-and-Ansible-Tower.html" />
    <meta property="article:published_time" content="2017-03-30T00:00:00.000Z" />
    <meta property="article:tag" content="ansible" />
    <meta property="article:tag" content="ansible tower" />
    <meta property="article:tag" content="satellite6" />
    <meta property="article:tag" content="youtube" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Connecting Satellite 6 and Ansible Tower" />
    <meta name="twitter:description" content="Today I want to talk about connecting Satellite 6 and Ansible Tower. There are two main benefits you can get right now from connecting Satellite 6 and Ansible Tower if you use both. Sharing inventory data First of all, if you share inventory data, you share hostnames and IP addresses" />
    <meta name="twitter:url" content="http://100things.wzzrd.com/2017/03/30/Connecting-Satellite-6-and-Ansible-Tower.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "100 things to do with Red Hat Management Products",
    "author": {
        "@type": "Person",
        "name": "Maxim Burgerhout",
        "image": "https://avatars1.githubusercontent.com/u/69339?v=4",
        "url": "http://100things.wzzrd.com/author/wzzrd/",
        "sameAs": "https://about.me/MaximBurgerhout",
        "description": "Solution architect at Red Hat for the platform and cloud portfolio; likes Python, likes Ruby, internally conflicted about that; maintainer of @RedHatSatellite"
    },
    "headline": "Connecting Satellite 6 and Ansible Tower",
    "url": "http://100things.wzzrd.com/2017/03/30/Connecting-Satellite-6-and-Ansible-Tower.html",
    "datePublished": "2017-03-30T00:00:00.000Z",
    "keywords": "ansible, ansible tower, satellite6, youtube",
    "description": "Today I want to talk about connecting Satellite 6 and Ansible Tower. There are two main benefits you can get right now from connecting Satellite 6 and Ansible Tower if you use both. Sharing inventory data First of all, if you share inventory data, you share hostnames and IP addresses"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="100 things to do with Red Hat Management Products" href="http://100things.wzzrd.com/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-okaidia.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>
<body class="post-template tag-ansible tag-ansible-tower tag-satellite6 tag-youtube">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="http://100things.wzzrd.com">100 things to do with Red Hat Management Products</a>
        <span class="blog-description">A series of blogs and videos about the cool things you can do with Red Hat (Systems) Management products </span>
        <nav class="links fadeIn animated">
            <ul>
                <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li>
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">Connecting Satellite 6 and Ansible Tower</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1490824800" datetime="2017-03-30T00:00" title="30 March 2017">a year ago</time></span>
            <span class="tags animated fadeInUp"><i class="fa fa-tags"></i> <a href="http://100things.wzzrd.com/tag/ansible/">ansible</a>, <a href="http://100things.wzzrd.com/tag/ansible-tower/">ansible tower</a>, <a href="http://100things.wzzrd.com/tag/satellite6/">satellite6</a>, <a href="http://100things.wzzrd.com/tag/youtube/">youtube</a></span>
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href="http://100things.wzzrd.com/author/wzzrd/">Maxim Burgerhout</a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post tag-ansible tag-ansible-tower tag-satellite6 tag-youtube">
        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Today I want to talk about connecting Satellite 6 and Ansible Tower. There are two main benefits you can get right now from connecting Satellite 6 and Ansible Tower if you use both.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharing_inventory_data">Sharing inventory data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First of all, if you share inventory data, you share hostnames and IP addresses of systems between Satellite 6 and Ansible Tower. This is valuable by itself, because who wants to keep track of systems in two different places, right? But apart from hostnames and IP addresses, Satellite 6 will offer all other information it has on those systems to Tower as well. This means you get access to what lifecycle environment a system is in, what content view it uses, and many more things.</p>
</div>
<div class="paragraph">
<p>Some of that information is available as variables at the system level, like the amount of outstanding errata and the name of the operating system.</p>
</div>
<div class="paragraph">
<p>Other things are used directly in Tower to group systems by. As an example, your hostgroups in Satellite will directly transfor into groups of systems in Tower as well, and this goes for lifecycle environments, content views and Puppet environments as well. That already should make your life a lot easier :)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://raw.githubusercontent.com/wzzrd/hubpress.io/gh-pages/images/imported_system.png" alt="Imported system" width="740" height="265">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_callbacks">Provisioning callbacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The second things you can more easily achieve by connecting Ansible Tower to Satellite 6, is the use of <strong>provisioning callbacks</strong>.</p>
</div>
<div class="paragraph">
<p>A provisioning callback is a special URL on the Tower server, that can be called by a client node to invoke a playbook run on itself. In order to successfully trigger a playbook run, a client node has to POST a special variable to the URL.</p>
</div>
<div class="paragraph">
<p>Tower will then refresh the inventory (you need to enable that on the inventory manually, by the way) and execute the Job Template associated with the provisioning callback.</p>
</div>
<div class="sect2">
<h3 id="_some_code_to_help_you_get_started">Some code to help you get started</h3>
<div class="paragraph">
<p>So what you need to do to make this work, is go to your Satellite and edit the provisioning template called "Satellite Kickstart Default". To this template, you add a little snippet near the end (preferably after the Puppet snippet, and before the 'Informing Satellite that we are built' part), that reads as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-erb" data-lang="erb"># This is RHEL7 specific code, as it uses systemctl, replace with
# chkconfig or an @boot cron if you run RHEL5 or RHEL6

&lt;% if @host.params['ansible_enabled'] == 'true' %&gt;
cat &gt; /etc/systemd/system/ansible-callback.service &lt;&lt; EOF
&lt;%= snippet 'ansible_callback_service' %&gt;
EOF

# Runs during first boot, removes itself
/usr/bin/systemctl enable ansible-callback
&lt;% end -%&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you create a new provisioning template, call it 'ansible_callback_service', and make it a snippet. Add the following code to it. Update the hostname below to match your environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[Unit]
Description=Provisioning callback to Ansible
Wants=network-online.target
After=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/bin/curl -k -s --data "host_config_key=&lt;%= @host.params['ansible_host_config_key'] -%&gt;" https://tower310.deployment6.lan/api/v1/job_templates/&lt;%= @host.params['ansible_job_template_id'] -%&gt;/callback/
ExecStartPost=/usr/bin/systemctl disable ansible-callback

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
<div class="paragraph">
<p>(I prefer to use a snippet for this for some more flexibility.)</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve done the above, you can assign the following variables to hosts or hostgroups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_enabled</code>: must be 'true' to enable provisioning callbacks to begin with</p>
</li>
<li>
<p><code>ansible_job_template_id</code>: the ID of the job template associated with the provisioning callback URL</p>
</li>
<li>
<p><code>ansible_host_config_key</code>: the variables that needs to be POSTed to the provisioning callback URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Make sure the inventory associated with this job template you are configuring provisioning callbacks for has 'Update on Launch' enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_systemd_service_or_boot_cronjob_or_init_script">systemd service, or @boot cronjob, or init script</h3>
<div class="paragraph">
<p>What the above will do is deploy a small systemd service on your new system. During first boot, this service will make systemd run a single cURL command and then disable the service again, so it&#8217;ll only run once at the very first boot.</p>
</div>
<div class="paragraph">
<p>You can also adapt this service to be a @boot cronjob, or traditional initscript as well, of course.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update_here_s_the_video">Update: here&#8217;s the video</h3>
<div class="paragraph">
<p>Duh. Forgot to include that at first :/</p>
</div>
<div class="videoblock">
<div class="content">
<iframe src="https://www.youtube.com/embed/SXhfgJjeaGc?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>Happy configuring!</p>
</div>
</div>
</div>
</div>
        </section>

    
        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = '100things'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>
    
    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">100 things to do with Red Hat Management Products</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="https://hubpress.github.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>

    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        // hljs.initHighlightingOnLoad();
      </script>
    <script src="//100things.wzzrd.com/themes/saga/assets/js/scripts.js?v=1530100205798"></script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1886096-11', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
